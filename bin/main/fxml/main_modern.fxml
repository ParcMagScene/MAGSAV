<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.magsav.gui.MainController"
            styleClass="main-layout">
            
  <stylesheets>
    <URL value="@../css/base.css"/>
    <URL value="@../css/themes/light.css"/>
    <URL value="@../css/components.css"/>
    <URL value="@../css/templates.css"/>
  </stylesheets>

  <!-- En-tÃªte moderne -->
  <top>
    <HBox styleClass="modern-header" spacing="16" alignment="CENTER_LEFT">
      <padding>
        <Insets top="16" bottom="16" left="24" right="24"/>
      </padding>
      
      <!-- Logo et titre -->
      <HBox spacing="12" alignment="CENTER_LEFT">
        <Label fx:id="companyNameLabel" text="MAGSAV" styleClass="app-title"/>
        <Separator orientation="VERTICAL"/>
        <Label text="Gestion du SAV" styleClass="modern-label, secondary"/>
      </HBox>
      
      <!-- Spacer -->
      <Region HBox.hgrow="ALWAYS"/>
      
      <!-- Actions principales -->
      <HBox spacing="12" alignment="CENTER_RIGHT">
        <Button fx:id="newInterventionBtn" text="Nouvelle Intervention" 
                styleClass="modern-button, success" onAction="#onNewIntervention"/>
        <Button fx:id="preferencesBtn" text="" styleClass="modern-button, outline" 
                onAction="#onOpenPreferences"/>
        <Button fx:id="userProfileBtn" text="" styleClass="modern-button, outline"/>
      </HBox>
    </HBox>
  </top>

  <!-- Sidebar de navigation -->
  <left>
    <VBox styleClass="modern-sidebar" spacing="8" prefWidth="250">
      <padding>
        <Insets top="24" bottom="24" left="16" right="16"/>
      </padding>
      
      <!-- Menu principal -->
      <VBox spacing="4">
        <Label text="NAVIGATION" styleClass="modern-label, small, secondary"/>
        <Button text="Dashboard" styleClass="modern-button, outline, menu-item" 
                maxWidth="Infinity"/>
        <Button text="Produits" styleClass="modern-button, outline, menu-item" 
                maxWidth="Infinity"/>
        <Button text="Clients" styleClass="modern-button, outline, menu-item" 
                maxWidth="Infinity"/>
        <Button text="Demandes" styleClass="modern-button, outline, menu-item" 
                onAction="#onOpenRequestsHub" maxWidth="Infinity"/>
        <Button text="Interventions" styleClass="modern-button, outline, menu-item" 
                maxWidth="Infinity"/>
      </VBox>
      
      <Separator/>
      
      <!-- Menu gestion -->
      <VBox spacing="4">
        <Label text="GESTION" styleClass="modern-label, small, secondary"/>
        <Button text="SociÃ©tÃ©s" styleClass="modern-button, outline, menu-item" 
                maxWidth="Infinity"/>
        <Button text="Utilisateurs" styleClass="modern-button, outline, menu-item" 
                maxWidth="Infinity"/>
        <Button text="Configuration" styleClass="modern-button, outline, menu-item" 
                onAction="#onOpenManagementHub" maxWidth="Infinity"/>
      </VBox>
      
      <Region VBox.vgrow="ALWAYS"/>
      
      <!-- Actions rapides -->
      <VBox spacing="8">
        <Separator/>
        <Label text="ACTIONS RAPIDES" styleClass="modern-label, small, secondary"/>
        <Button text="Export Stock" styleClass="modern-button, small" 
                onAction="#onExportStockReport" maxWidth="Infinity"/>
        <Button text="Test Glisser-DÃ©poser" styleClass="modern-button, small, outline" 
                onAction="#onTestDropZones" maxWidth="Infinity"/>
      </VBox>
    </VBox>
  </left>

  <!-- Contenu principal -->
  <center>
    <VBox styleClass="content-area" spacing="24">
      <padding>
        <Insets top="24" bottom="24" left="24" right="24"/>
      </padding>
      
      <!-- En-tÃªte de la liste des produits -->
      <VBox spacing="16">
        <Label text="Liste des produits" styleClass="modern-title"/>
        
        <!-- Barre de recherche moderne centrÃ©e -->
        <HBox alignment="CENTER" spacing="8">
          <HBox styleClass="search-container" spacing="8" alignment="CENTER_LEFT" 
                prefWidth="400" maxWidth="400">
            <Label text="ðŸ”" styleClass="modern-label, small"/>
            <TextField fx:id="productSearchField" promptText="Rechercher un produit..." 
                      styleClass="modern-text-field" style="-fx-border-width: 0; -fx-background-color: transparent;"
                      HBox.hgrow="ALWAYS"/>
            <Button text="Ã—" styleClass="modern-button, small" onAction="#onClearProductSearch"/>
          </HBox>
        </HBox>
        
        <!-- Stats rapides -->
        <HBox spacing="16">
          <VBox styleClass="dashboard-card, compact" spacing="8" prefWidth="150">
            <Label text="TOTAL PRODUITS" styleClass="dashboard-title"/>
            <Label fx:id="totalProductsLabel" text="0" styleClass="dashboard-value" 
                   style="-fx-font-size: 24px;"/>
          </VBox>
          <VBox styleClass="dashboard-card, compact" spacing="8" prefWidth="150">
            <Label text="EN RÃ‰PARATION" styleClass="dashboard-title"/>
            <Label fx:id="inRepairLabel" text="0" styleClass="dashboard-value" 
                   style="-fx-font-size: 24px; -fx-text-fill: #f59e0b;"/>
          </VBox>
          <VBox styleClass="dashboard-card, compact" spacing="8" prefWidth="150">
            <Label text="RÃ‰PARÃ‰S" styleClass="dashboard-title"/>
            <Label fx:id="repairedLabel" text="0" styleClass="dashboard-value" 
                   style="-fx-font-size: 24px; -fx-text-fill: #10b981;"/>
          </VBox>
        </HBox>
      </VBox>
      
      <!-- Table moderne des produits -->
      <TableView fx:id="productTable" styleClass="modern-table-view" VBox.vgrow="ALWAYS">
        <columns>
          <TableColumn fx:id="colProdNom" text="Produit" prefWidth="200.0"/>
          <TableColumn fx:id="colProdSN" text="NÂ° de sÃ©rie" prefWidth="120.0"/>
          <TableColumn fx:id="colProdUID" text="UID" prefWidth="80.0"/>
          <TableColumn fx:id="colProdFabricant" text="Fabricant" prefWidth="150.0"/>
          <TableColumn fx:id="colProdSituation" text="Situation" prefWidth="120.0"/>
        </columns>
        <columnResizePolicy>
          <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
        </columnResizePolicy>
        <placeholder>
          <VBox spacing="16" alignment="CENTER">
            <Label text="ðŸ“¦" style="-fx-font-size: 48px; -fx-opacity: 0.5;"/>
            <Label text="Aucun produit trouvÃ©" styleClass="modern-label, secondary"/>
            <Button text="Ajouter un produit" styleClass="modern-button, primary"/>
          </VBox>
        </placeholder>
      </TableView>
    </VBox>
  </center>

  <!-- Panneau de dÃ©tails moderne -->
  <right>
    <VBox styleClass="modern-card" spacing="24" prefWidth="400" maxWidth="400">
      <padding>
        <Insets top="24" bottom="24" left="24" right="24"/>
      </padding>
      
      <!-- En-tÃªte du produit sÃ©lectionnÃ© -->
      <VBox spacing="16">
        <Label text="DÃ©tails du produit" styleClass="modern-subtitle"/>
        
        <!-- Images optimisÃ©es dans des cartes -->
        <HBox spacing="12" alignment="TOP_CENTER">
          <!-- Logo fabricant -->
          <VBox styleClass="modern-card, compact" spacing="8" alignment="TOP_CENTER" 
                prefWidth="110" maxWidth="110">
            <Label text="Fabricant" styleClass="modern-label, small, secondary"/>
            <StackPane prefWidth="80" prefHeight="80" styleClass="image-container">
              <Label text="ðŸ­" style="-fx-font-size: 24px; -fx-opacity: 0.3;"/>
              <ImageView fx:id="imgManufacturerLogo" fitWidth="80" fitHeight="80" 
                        preserveRatio="true" smooth="true"/>
            </StackPane>
            <Label fx:id="lblProdManufacturer" styleClass="modern-label, small" 
                   wrapText="true" maxWidth="100" textAlignment="CENTER"/>
          </VBox>
          
          <!-- Photo produit -->
          <VBox styleClass="modern-card, compact" spacing="8" alignment="TOP_CENTER"
                prefWidth="110" maxWidth="110">
            <Label text="Produit" styleClass="modern-label, small, secondary"/>
            <StackPane prefWidth="80" prefHeight="80" styleClass="image-container">
              <Label text="ðŸ“·" style="-fx-font-size: 24px; -fx-opacity: 0.3;"/>
              <ImageView fx:id="imgProductPhoto" fitWidth="80" fitHeight="80" 
                        preserveRatio="true" smooth="true"/>
            </StackPane>
            <Label fx:id="lblProdName" styleClass="modern-label, small" 
                   wrapText="true" maxWidth="100" textAlignment="CENTER"/>
          </VBox>
          
          <!-- QR Code -->
          <VBox styleClass="modern-card, compact" spacing="8" alignment="TOP_CENTER"
                prefWidth="110" maxWidth="110">
            <Label text="QR Code" styleClass="modern-label, small, secondary"/>
            <StackPane prefWidth="80" prefHeight="80" styleClass="image-container">
              <Label text="âš" style="-fx-font-size: 24px; -fx-opacity: 0.3;"/>
              <ImageView fx:id="imgQr" fitWidth="80" fitHeight="80" 
                        preserveRatio="true" smooth="true"/>
            </StackPane>
            <VBox spacing="2" alignment="TOP_CENTER">
              <Label fx:id="lblQrUID" styleClass="modern-label, small" 
                     wrapText="true" maxWidth="100" textAlignment="CENTER"/>
              <Label fx:id="lblQrSN" styleClass="modern-label, small, secondary" 
                     wrapText="true" maxWidth="100" textAlignment="CENTER"/>
            </VBox>
          </VBox>
        </HBox>
      </VBox>
      
      <Separator/>
      
      <!-- Informations dÃ©taillÃ©es -->
      <VBox spacing="16">
        <Label text="Informations" styleClass="modern-label, secondary, small"/>
        <GridPane hgap="16" vgap="12">
          <columnConstraints>
            <ColumnConstraints minWidth="100" prefWidth="100"/>
            <ColumnConstraints hgrow="ALWAYS"/>
          </columnConstraints>
          
          <Label text="CatÃ©gorie" styleClass="modern-label, small, secondary" 
                 GridPane.rowIndex="0" GridPane.columnIndex="0"/>
          <Label fx:id="lblProdCategory" styleClass="modern-label, small" 
                 GridPane.rowIndex="0" GridPane.columnIndex="1"/>

          <Label text="Sous-catÃ©gorie" styleClass="modern-label, small, secondary" 
                 GridPane.rowIndex="1" GridPane.columnIndex="0"/>
          <Label fx:id="lblProdSubcategory" styleClass="modern-label, small" 
                 GridPane.rowIndex="1" GridPane.columnIndex="1"/>

          <Label text="Sous-sous-cat." styleClass="modern-label, small, secondary" 
                 GridPane.rowIndex="2" GridPane.columnIndex="0"/>
          <Label fx:id="lblProdSubSubcategory" styleClass="modern-label, small" 
                 GridPane.rowIndex="2" GridPane.columnIndex="1"/>

          <Label text="Situation" styleClass="modern-label, small, secondary" 
                 GridPane.rowIndex="3" GridPane.columnIndex="0"/>
          <HBox spacing="8" alignment="CENTER_LEFT" GridPane.rowIndex="3" GridPane.columnIndex="1">
            <Label text="â—" fx:id="statusIndicator" style="-fx-text-fill: #10b981;"/>
            <Label fx:id="lblProdSituation" styleClass="modern-label, small"/>
          </HBox>
        </GridPane>
      </VBox>
      
      <Separator/>
      
      <!-- Actions -->
      <VBox spacing="16">
        <Label text="Actions" styleClass="modern-label, secondary, small"/>
        
        <!-- Action principale -->
        <Button fx:id="btnEditProduct" text="Ã‰diter ce produit" 
                styleClass="modern-button, success" onAction="#onEditProduct" 
                disable="true" maxWidth="Infinity"/>
        
        <!-- Actions de partage -->
        <VBox spacing="8">
          <Label text="Partage et export" styleClass="modern-label, small, secondary"/>
          <HBox spacing="8">
            <Button fx:id="btnExportProduct" text="Export" styleClass="modern-button, small" 
                    onAction="#onExportProduct" disable="true" HBox.hgrow="ALWAYS"/>
            <Button fx:id="btnPrintProduct" text="Imprimer" styleClass="modern-button, small" 
                    onAction="#onPrintProduct" disable="true" HBox.hgrow="ALWAYS"/>
            <Button fx:id="btnEmailProduct" text="Email" styleClass="modern-button, small" 
                    onAction="#onEmailProduct" disable="true" HBox.hgrow="ALWAYS"/>
          </HBox>
          <Button fx:id="btnShareProduct" text="Partage complet" 
                  styleClass="modern-button, primary, small" onAction="#onShareProduct" 
                  disable="true" maxWidth="Infinity"/>
        </VBox>
      </VBox>
      
      <Separator/>
      
      <!-- Historique moderne -->
      <VBox spacing="16" VBox.vgrow="ALWAYS">
        <HBox alignment="CENTER_LEFT" spacing="12">
          <Label text="Historique" styleClass="modern-label, secondary, small"/>
          <Region HBox.hgrow="ALWAYS"/>
          <Label fx:id="historyCountLabel" text="0 entrÃ©e(s)" 
                 styleClass="modern-label, small, secondary"/>
        </HBox>
        
        <TableView fx:id="historyTable" styleClass="modern-table-view" 
                   VBox.vgrow="ALWAYS" maxHeight="200">
          <columns>
            <TableColumn fx:id="hColId" text="#" prefWidth="40"/>
            <TableColumn fx:id="hColStatut" text="Statut" prefWidth="80"/>
            <TableColumn fx:id="hColPanne" text="Panne" prefWidth="120"/>
            <TableColumn fx:id="hColEntree" text="EntrÃ©e" prefWidth="80"/>
            <TableColumn fx:id="hColSortie" text="Sortie" prefWidth="80"/>
          </columns>
          <columnResizePolicy>
            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
          </columnResizePolicy>
          <placeholder>
            <VBox spacing="8" alignment="CENTER">
              <Label text="ðŸ“" style="-fx-font-size: 24px; -fx-opacity: 0.3;"/>
              <Label text="Aucun historique" styleClass="modern-label, small, secondary"/>
            </VBox>
          </placeholder>
        </TableView>
      </VBox>
    </VBox>
  </right>

  <!-- Barre de statut moderne -->
  <bottom>
    <HBox styleClass="modern-status-bar" spacing="16" alignment="CENTER_LEFT">
      <padding>
        <Insets top="8" bottom="8" left="24" right="24"/>
      </padding>
      
      <Label fx:id="statusLabel" text="PrÃªt" styleClass="modern-label, small"/>
      
      <Region HBox.hgrow="ALWAYS"/>
      
      <Label text="MAGSAV 1.2" styleClass="modern-label, small, secondary"/>
    </HBox>
  </bottom>
</BorderPane>