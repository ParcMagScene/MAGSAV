<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.magsav.gui.MainController">
  <top>
    <ToolBar>
      <MenuButton fx:id="companyMenuButton">
        <graphic>
          <HBox spacing="8" alignment="CENTER_LEFT">
            <ImageView fx:id="companyLogoImage" fitWidth="24" fitHeight="24" preserveRatio="true"
                       style="-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.3), 2, 0.5, 1, 1);"/>
            <Label fx:id="companyNameLabel" text="Mag ScÃ¨ne" style="-fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
          </HBox>
        </graphic>
        <items>
          <MenuItem text="âš™ï¸ PrÃ©fÃ©rences" onAction="#onOpenPreferences" style="-fx-font-weight: bold;"/>
          <MenuItem text="ðŸ“ Gestion" onAction="#onOpenManagementHub" style="-fx-font-weight: bold;"/>
          <MenuItem text="ðŸ“‹ Demandes" onAction="#onOpenRequestsHub" style="-fx-font-weight: bold;"/>
          <MenuItem text="ðŸ§ª Test Glisser-DÃ©poser" onAction="#onTestDropZones" style="-fx-font-style: italic;"/>
          <SeparatorMenuItem/>
          <Menu text="ðŸ“Š Rapports &amp; Export">
            <items>
              <MenuItem text="ðŸ“„ Export Stock HTML" onAction="#onExportStockReport"/>
              <MenuItem text="ðŸ“¦ Export Base ComplÃ¨te" onAction="#onExportCompleteDatabase"/>
              <SeparatorMenuItem/>
              <MenuItem text="ðŸ–¨ï¸ Imprimer Stock" onAction="#onPrintStockReport"/>
              <MenuItem text="ðŸ–¨ï¸ Imprimer Base ComplÃ¨te" onAction="#onPrintCompleteDatabase"/>
              <SeparatorMenuItem/>
              <MenuItem text="ðŸ“§ Envoyer Stock par Email" onAction="#onEmailStockReport"/>
              <MenuItem text="ðŸ“§ Envoyer Base par Email" onAction="#onEmailCompleteDatabase"/>
            </items>
          </Menu>
        </items>
      </MenuButton>
      <Separator/>
      <Label text="MAGSAV 1.2"/>
      <Pane HBox.hgrow="ALWAYS"/>
      <Button text="+ Intervention" onAction="#onNewIntervention"/>

    </ToolBar>
  </top>

  <center>
    <VBox spacing="4" style="-fx-padding: 8;">
      <Label text="Liste des produits" style="-fx-font-weight: bold; -fx-font-size: 13;"/>
      <HBox spacing="8">
        <TextField fx:id="productSearchField" promptText="Rechercher un produit..." HBox.hgrow="ALWAYS"/>
        <Button text="Ã—" onAction="#onClearProductSearch">
          <tooltip><Tooltip text="Effacer la recherche"/></tooltip>
        </Button>
      </HBox>
      <TableView fx:id="productTable" VBox.vgrow="ALWAYS">
        <columns>
          <TableColumn fx:id="colProdNom" text="Produit" prefWidth="200.0"/>
          <TableColumn fx:id="colProdSN" text="NÂ° de sÃ©rie" prefWidth="120.0"/>
          <TableColumn fx:id="colProdUID" text="UID" prefWidth="80.0"/>
          <TableColumn fx:id="colProdFabricant" text="Fabricant" prefWidth="150.0"/>
          <TableColumn fx:id="colProdSituation" text="Situation" prefWidth="120.0"/>
        </columns>
        <columnResizePolicy>
          <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
        </columnResizePolicy>
        <placeholder><Label text="Aucun produit"/></placeholder>
      </TableView>
    </VBox>
  </center>

  <right>
    <VBox spacing="8" style="-fx-padding: 8; -fx-background-color: -fx-base;" prefWidth="360">


      <!-- Images optimisÃ©es (1/3 max du volet) -->
      <HBox spacing="8" alignment="TOP_CENTER" style="-fx-padding: 4; -fx-border-color: #e0e0e0; -fx-border-radius: 4;" maxHeight="120">
        <!-- Logo fabricant -->
        <VBox spacing="2" alignment="TOP_CENTER" prefWidth="110">
          <ImageView fx:id="imgManufacturerLogo" fitWidth="80" fitHeight="80" preserveRatio="true" smooth="true" style="-fx-background-color: #fafafa; -fx-border-color: #e0e0e0; -fx-border-radius: 4;"/>
          <Label fx:id="lblProdManufacturer" style="-fx-font-weight: bold; -fx-font-size: 10; -fx-text-alignment: center; -fx-alignment: center;" wrapText="true" maxWidth="110" prefWidth="110"/>
        </VBox>
        
        <!-- Photo produit -->
        <VBox spacing="2" alignment="TOP_CENTER" prefWidth="110">
          <ImageView fx:id="imgProductPhoto" fitWidth="80" fitHeight="80" preserveRatio="true" smooth="true" style="-fx-background-color: #fafafa; -fx-border-color: #e0e0e0; -fx-border-radius: 4;"/>
          <Label fx:id="lblProdName" style="-fx-font-weight: bold; -fx-font-size: 10; -fx-text-alignment: center; -fx-alignment: center;" wrapText="true" maxWidth="110" prefWidth="110"/>
        </VBox>
        
        <!-- QR Code -->
        <VBox spacing="2" alignment="TOP_CENTER" prefWidth="110">
          <ImageView fx:id="imgQr" fitWidth="80" fitHeight="80" preserveRatio="true" smooth="true" style="-fx-background-color: #fafafa; -fx-border-color: #e0e0e0; -fx-border-radius: 4;"/>
          <VBox spacing="1" alignment="TOP_CENTER" prefWidth="110">
            <Label fx:id="lblQrUID" style="-fx-font-weight: bold; -fx-font-size: 10; -fx-text-alignment: center; -fx-alignment: center;" wrapText="true" maxWidth="110" prefWidth="110"/>
            <Label fx:id="lblQrSN" style="-fx-font-weight: bold; -fx-font-size: 10; -fx-text-alignment: center; -fx-alignment: center;" wrapText="true" maxWidth="110" prefWidth="110"/>
          </VBox>
        </VBox>
      </HBox>

      <!-- 4. DÃ©tails produit (catÃ©gories, situation, etc.) -->
      <Label text="DÃ©tails du produit" style="-fx-font-weight: bold; -fx-font-size: 13;"/>
      <GridPane hgap="8" vgap="6">
        <columnConstraints>
          <ColumnConstraints minWidth="100"/>
          <ColumnConstraints hgrow="ALWAYS" minWidth="220"/>
        </columnConstraints>
        <children>
          <Label fx:id="lblCategoryTitle" text="CatÃ©gorie:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
          <Label fx:id="lblProdCategory" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

          <Label fx:id="lblSubcategoryTitle" text="Sous-catÃ©gorie:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
          <Label fx:id="lblProdSubcategory" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

          <Label fx:id="lblSubSubcategoryTitle" text="Sous-sous-catÃ©gorie:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
          <Label fx:id="lblProdSubSubcategory" GridPane.rowIndex="2" GridPane.columnIndex="1"/>

          <Label text="Situation:" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
          <Label fx:id="lblProdSituation" GridPane.rowIndex="3" GridPane.columnIndex="1"/>
        </children>
      </GridPane>

      <!-- 5. Boutons d'action -->
      <Button fx:id="btnEditProduct" text="Ã‰diter ce produit" onAction="#onEditProduct" 
              style="-fx-background-color: #4CAF50; -fx-text-fill: white;" disable="true"/>

      <VBox spacing="6">
        <Label text="Actions de partage" style="-fx-font-weight: bold; -fx-font-size: 12;"/>
        <HBox spacing="4">
          <Button fx:id="btnExportProduct" text="ðŸ“„ Export" onAction="#onExportProduct" 
                  style="-fx-font-size: 10;" disable="true" prefWidth="70"/>
          <Button fx:id="btnPrintProduct" text="ðŸ–¨ï¸ Print" onAction="#onPrintProduct" 
                  style="-fx-font-size: 10;" disable="true" prefWidth="70"/>
          <Button fx:id="btnEmailProduct" text="ðŸ“§ Email" onAction="#onEmailProduct" 
                  style="-fx-font-size: 10;" disable="true" prefWidth="70"/>
        </HBox>
        <Button fx:id="btnShareProduct" text="ðŸš€ Partage complet" onAction="#onShareProduct" 
                style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-size: 11;" 
                disable="true" prefWidth="220"/>
      </VBox>

      <Label text="Historique" style="-fx-font-weight: bold;"/>
      <TableView fx:id="historyTable" prefHeight="220">
        <columns>
          <TableColumn fx:id="hColId" text="#" prefWidth="60"/>
          <TableColumn fx:id="hColStatut" text="Statut" prefWidth="110"/>
          <TableColumn fx:id="hColPanne" text="Panne" prefWidth="180"/>
          <TableColumn fx:id="hColEntree" text="EntrÃ©e" prefWidth="100"/>
          <TableColumn fx:id="hColSortie" text="Sortie" prefWidth="100"/>
        </columns>
        <columnResizePolicy>
          <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
        </columnResizePolicy>
      </TableView>
    </VBox>
  </right>

  <bottom>
    <HBox spacing="8" style="-fx-padding: 8;">
      <Label text="PrÃªt"/>
    </HBox>
  </bottom>
</BorderPane>