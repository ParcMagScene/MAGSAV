<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Recherche Avanc√©e - MAGSAV</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/search-advanced.css}" rel="stylesheet">
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">üîß MAGSAV 1.1</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/dossier/nouveau" sec:authorize="hasRole('ADMIN')">Nouveau</a>
                <div class="nav-item dropdown" sec:authorize="hasRole('ADMIN')">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        Import CSV
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/import/advanced">Interface avanc√©e</a></li>
                        <li><a class="dropdown-item" href="/import">Interface classique</a></li>
                    </ul>
                </div>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle active" href="#" role="button" data-bs-toggle="dropdown">
                        Recherche
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item active" href="/search/advanced">Recherche avanc√©e</a></li>
                        <li><a class="dropdown-item" href="/dossier/liste">Liste simple</a></li>
                    </ul>
                </div>
            </div>
            <div class="navbar-nav ms-auto">
                <form class="d-inline" th:action="@{/logout}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn btn-outline-light btn-sm">D√©connexion</button>
                </form>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <!-- Panel de recherche -->
                <div class="search-panel">
                    <div class="search-header">
                        <div>
                            <h2 class="mb-1">üîç Recherche Avanc√©e</h2>
                            <p class="text-muted mb-0">Trouvez rapidement vos dossiers SAV</p>
                        </div>
                        <div class="search-mode-toggle">
                            <button class="search-mode-btn active" id="simpleMode">Simple</button>
                            <button class="search-mode-btn" id="advancedMode">Avanc√©</button>
                        </div>
                    </div>

                    <!-- Filtres rapides -->
                    <div class="quick-filters" id="quickFilters">
                        <div class="filter-chip active" data-filter="all">
                            <span>üìã Tous</span>
                            <span class="count" id="countAll">0</span>
                        </div>
                        <div class="filter-chip" data-filter="recu">
                            <span>üì• Re√ßus</span>
                            <span class="count" id="countRecu">0</span>
                        </div>
                        <div class="filter-chip" data-filter="en_cours">
                            <span>‚ö†Ô∏è En cours</span>
                            <span class="count" id="countEnCours">0</span>
                        </div>
                        <div class="filter-chip" data-filter="reparation">
                            <span>üîß R√©paration</span>
                            <span class="count" id="countReparation">0</span>
                        </div>
                        <div class="filter-chip" data-filter="termine">
                            <span>‚ú® Termin√©s</span>
                            <span class="count" id="countTermine">0</span>
                        </div>
                        <div class="filter-chip" data-filter="urgent">
                            <span>üö® Urgents</span>
                            <span class="count" id="countUrgent">0</span>
                        </div>
                    </div>

                    <!-- Barre de recherche principale -->
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" 
                               placeholder="Rechercher par client, num√©ro de s√©rie, marque, mod√®le...">
                        <button class="search-btn" id="searchBtn">
                            üîç
                        </button>
                    </div>

                    <!-- Filtres avanc√©s -->
                    <div class="advanced-filters" id="advancedFilters">
                        <form id="advancedSearchForm">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="filter-section">
                                        <h5 class="filter-title">
                                            üë§ Informations Client
                                        </h5>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Nom client</label>
                                                <input type="text" class="form-control" name="clientNom" 
                                                       placeholder="Nom du client">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" name="clientEmail" 
                                                       placeholder="Email du client">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">T√©l√©phone</label>
                                                <input type="tel" class="form-control" name="clientTelephone" 
                                                       placeholder="T√©l√©phone">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Ville</label>
                                                <input type="text" class="form-control" name="clientVille" 
                                                       placeholder="Ville du client">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="filter-section">
                                        <h5 class="filter-title">
                                            üì± Informations Appareil
                                        </h5>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Marque</label>
                                                <select class="form-select" name="appareilMarque">
                                                    <option value="">Toutes les marques</option>
                                                    <option value="Apple">Apple</option>
                                                    <option value="Samsung">Samsung</option>
                                                    <option value="Huawei">Huawei</option>
                                                    <option value="Xiaomi">Xiaomi</option>
                                                    <option value="OnePlus">OnePlus</option>
                                                    <option value="Google">Google</option>
                                                    <option value="Sony">Sony</option>
                                                    <option value="Other">Autre</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Mod√®le</label>
                                                <input type="text" class="form-control" name="appareilModele" 
                                                       placeholder="Mod√®le de l'appareil">
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">Num√©ro de s√©rie</label>
                                                <input type="text" class="form-control" name="numeroSerie" 
                                                       placeholder="Num√©ro de s√©rie">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="filter-section">
                                        <h5 class="filter-title">
                                            üìÖ Dates
                                        </h5>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Date entr√©e (de)</label>
                                                <input type="date" class="form-control" name="dateEntreeDebut">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Date entr√©e (√†)</label>
                                                <input type="date" class="form-control" name="dateEntreeFin">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Date sortie (de)</label>
                                                <input type="date" class="form-control" name="dateSortieDebut">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Date sortie (√†)</label>
                                                <input type="date" class="form-control" name="dateSortieFin">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="filter-section">
                                        <h5 class="filter-title">
                                            üîß D√©tails SAV
                                        </h5>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Statut</label>
                                                <select class="form-select" name="statut" multiple>
                                                    <option value="recu">üì• Re√ßu</option>
                                                    <option value="diagnostic">üîç Diagnostic</option>
                                                    <option value="en_cours">‚ö†Ô∏è En cours</option>
                                                    <option value="attente_pieces">‚è±Ô∏è Attente pi√®ces</option>
                                                    <option value="reparation">üîß R√©paration</option>
                                                    <option value="teste">‚úÖ Test√©</option>
                                                    <option value="pret">üì¶ Pr√™t</option>
                                                    <option value="termine">‚ú® Termin√©</option>
                                                    <option value="annule">‚ùå Annul√©</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Sympt√¥me</label>
                                                <input type="text" class="form-control" name="symptome" 
                                                       placeholder="Sympt√¥me ou probl√®me">
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">Commentaire</label>
                                                <input type="text" class="form-control" name="commentaire" 
                                                       placeholder="Commentaire du dossier">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-3">
                                <button type="button" class="btn btn-outline-secondary me-2" id="clearFilters">
                                    üóëÔ∏è Effacer les filtres
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    üîç Rechercher
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- R√©sultats -->
                <div class="results-header d-none" id="resultsHeader">
                    <div class="results-count">
                        <strong id="resultsCount">0</strong> dossier(s) trouv√©(s)
                    </div>
                    <div class="results-actions">
                        <select class="form-select sort-dropdown" id="sortSelect">
                            <option value="id_desc">Plus r√©cents d'abord</option>
                            <option value="id_asc">Plus anciens d'abord</option>
                            <option value="client_asc">Client A-Z</option>
                            <option value="client_desc">Client Z-A</option>
                            <option value="statut_asc">Statut A-Z</option>
                            <option value="date_entree_desc">Entr√©e r√©cente</option>
                        </select>
                        <div class="view-toggle">
                            <button class="view-btn active" id="cardView">üìã</button>
                            <button class="view-btn" id="tableView">üìä</button>
                        </div>
                        <button class="btn btn-outline-primary" id="exportBtn">
                            üì§ Exporter
                        </button>
                    </div>
                </div>

                <!-- Spinner de chargement -->
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <p>Recherche en cours...</p>
                </div>

                <!-- R√©sultats en cartes -->
                <div id="cardResults" class="card-results">
                    <!-- R√©sultats g√©n√©r√©s dynamiquement -->
                </div>

                <!-- R√©sultats en tableau -->
                <div id="tableResults" class="table-view d-none">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Client</th>
                                <th>Appareil</th>
                                <th>Probl√®me</th>
                                <th>Statut</th>
                                <th>Date entr√©e</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- R√©sultats g√©n√©r√©s dynamiquement -->
                        </tbody>
                    </table>
                </div>

                <!-- √âtat vide -->
                <div class="empty-state d-none" id="emptyState">
                    <div class="icon">üîç</div>
                    <h4>Aucun r√©sultat trouv√©</h4>
                    <p>Essayez de modifier vos crit√®res de recherche</p>
                </div>

                <!-- Pagination -->
                <div class="pagination-advanced d-none" id="pagination">
                    <div class="pagination-info" id="paginationInfo"></div>
                    <nav>
                        <ul class="pagination" id="paginationNav">
                            <!-- Pagination g√©n√©r√©e dynamiquement -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/app-search-advanced.js}"></script>
</body>
</html>